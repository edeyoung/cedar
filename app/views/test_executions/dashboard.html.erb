<div class='container'>
  <% flash.each do |name, msg| %>
    <% if flash.keys[0] == 'error' %>
      <%= content_tag :div, msg.html_safe, class: 'alert alert-danger' %>
    <% else %>
      <%= content_tag :div, msg.html_safe, class: 'alert alert-info' %>
    <% end %>
  <% end %>

  <script>
    $(document).ready( function(){
      $('[data-toggle="tooltip"]').tooltip()
    });
  </script>

  <div id='totals'>
    <%= render partial: 'test_executions/dashboard_totals',
               locals: {test_executions_num: @test_executions.length,
                        tests_passed_num: @tests_passed.length,
                        tests_failed_num: @tests_failed.length,
                        tests_incomplete_num: @tests_incomplete.length} %>
  </div>

  <% unless @prevent_test %>
    <div class='col-lg-12 text-center'>
      <%= link_to new_test_execution_path, class: 'btn btn-primary btn-lg' do %>
        <i class='glyphicon glyphicon-leaf'></i>&nbsp;Create a New Test
      <% end %>
    </div>
  <% end %>

  <div class='clearfix'></div>
  <div style='height: 40px'></div>

  <ul class='nav nav-tabs'>
    <li class='active' role='presentation'>
      <a data-toggle="tab" href='#panels'>Tests</a>
    </li>
    <li role='presentation'>
      <a data-toggle="tab" href='#coverage'>Validation Coverage</a>
    </li>
  </ul>

  <div class='tab-content'>
    <div id='panels' class='tab-pane fade in active'>
      <%= render partial: 'test_executions/dashboard_panel_tests',
                 locals: {panel_title: 'PASSED',
                          tests: @tests_passed} %>
      <%= render partial: 'test_executions/dashboard_panel_tests',
                 locals: {panel_title: 'FAILED',
                          tests: @tests_failed} %>
      <%= render partial: 'test_executions/dashboard_panel_tests',
                 locals: {panel_title: 'INCOMPLETE',
                          tests: @tests_incomplete} %>
    </div>
    <div id='coverage' class='tab-pane fade'>
      <%= render partial: 'test_executions/dashboard_coverage',
                 locals: {tests: @tests_complete,
                          validations: @validations} %>
    </div>

    <div class='clearfix'></div>

    <script type="text/javascript">
    $(document).ready(function() {
      $('input[class="daterange"]').daterangepicker({
        'opens':'left',
        'drops': 'up',
        'startDate': moment.unix(<%= @tests_complete.first.created_at.to_i %>),
        'endDate': moment.unix(<%= @tests_complete.last.created_at.to_i %>),
        'minDate': moment.unix(<%= @tests_complete.first.created_at.to_i %>),
        'maxDate': moment.unix(<%= @tests_complete.last.created_at.to_i %>+1)
      },
      function(start, end, label){
        $.ajax({
          type: "POST",
          url: "/test_executions/with_time_range",
          data: {'start': start.unix(), 'end': end.unix()}
        });
      });
    });
    </script>

    <div class='pull-right'>
      <p>
        Date range: <input type= 'text' class='daterange'  />
      </p>
    </div>
  </div>
</div>
